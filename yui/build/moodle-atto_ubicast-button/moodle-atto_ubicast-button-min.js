YUI.add("moodle-atto_ubicast-button",function(d,t){"use strict";var s="atto_ubicast",e=".atto_ubicast_button",r=0,i=!0;function o(){var t,e;for(t=0;t<window.document.body.classList.length;t++)if(window.document.body.classList[t].startsWith("course"))return 2===(e=window.document.body.classList[t].split("-")).length&&parseInt(e[1],10)||0;return 0}d.namespace("M.atto_ubicast").Button=d.Base.create("button",d.M.editor_atto.EditorPlugin,[],{initializer:function(){this.addButton({icon:"icon",iconComponent:s,callback:this.openChoicesDialogue}),i&&($.getScript("/mod/ubicast/statics/jquery.min.js?_=11"),$.getScript("/mod/ubicast/statics/media_selector.js?_=11"),r=o(),o()<2&&$(e).hide(),i=!1)},_currentSelection:null,_dialogContent:null,openChoicesDialogue:function(){this._showDialogue()},_showDialogue:function(){var n,t,a;this._currentSelection=this.get("host").getSelection(),!1!==this._currentSelection&&(n=this.getDialogue({headerContent:M.util.get_string("pluginname",s),width:"425px",focusAfterHide:!0}),t="/lib/editor/atto/plugins/ubicast/media.php",a=this,$.ajax({url:t,type:"GET",success:function(t){var e=d.Node.create(t),i=d.Node.create('<div style="text-align: center;"></div>'),o=M.util.get_string("inputsubmit",s);i.append(d.Node.create('<button type="submit" class="submit">'+o+"</button>")),e.append(i),e.on("submit",a._setVideo,a),a._dialogContent=e,n.set("bodyContent",e).show(),window.mediaSelector=new window.MediaSelector({moodleURL:window.M.cfg.wwwroot+"/mod/ubicast/lti.php?id="+r,mediaserverURL:$(t).find("#ms_mediaserverURL").val(),target:"id_resource_atto_ubicast"})}}))},_setVideo:function(t){var e,i,o,n,a,s;return t.preventDefault(),this.getDialogue({focusAfterHide:null}).hide(),e=this._dialogContent.one("#id_mediaid").get("value"),i=this._dialogContent.one("#media_width").get("value"),o=this._dialogContent.one("#media_height").get("value"),e&&(n=this.get("host"),this.editor.focus(),n.setSelection(this._currentSelection),a='<iframe class="mediaserver-iframe" style="width: {{ mediaW }}; height: {{ mediaH }}; background-color: #ddd;" src="/lib/editor/atto/plugins/ubicast/view.php?course={{ courseId }}&video={{ mediaId }}/" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen="allowfullscreen"></iframe>',s=d.Handlebars.compile(a)({courseId:r,mediaId:e,mediaW:i,mediaH:o}),n.insertContentAtFocusPoint(s),this.markUpdated()),!1}})},"@VERSION@",{requires:["promise","moodle-editor_atto-plugin","event-valuechange"]});